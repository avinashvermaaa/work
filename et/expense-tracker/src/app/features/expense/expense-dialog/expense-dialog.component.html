<div class="heading">
  <h2 mat-dialog-title>{{ data ? 'Edit' : 'Add' }} Expense</h2>
</div>

<div class="stepper">
  <div
    *ngFor="let step of steps; let i = index"
    class="step"
    [class.active]="currentStep === i"
    [class.completed]="i < currentStep"
  >
    <div class="step-index">
      <span *ngIf="i < currentStep" class="material-icons">check</span>
      <span *ngIf="i >= currentStep">{{ i + 1 }}</span>
    </div>
    <div class="step-label">{{ step }}</div>
  </div>
</div>

<mat-dialog-content [formGroup]="form" class="form-content">

  <ng-container *ngIf="currentStep === 0">
    <mat-form-field class="full-width">
      <mat-label>Title</mat-label>
      <input matInput formControlName="title" />
      <mat-error *ngIf="showError('title')">
        {{ controls['title'].hasError('required') ? 'Required' : 'cannot start from whitespace & Max 15 Char' }}
      </mat-error>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Amount</mat-label>
      <input matInput type="number" formControlName="amount" />
      <mat-error *ngIf="showError('amount')">
        {{ controls['amount'].hasError('required') ? 'Required' : 'Min ₹1, Max ₹100,00,00,000 , Round of upto 2 digit Ex:- 1.23, 69' }}
      </mat-error>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Category</mat-label>
      <mat-select formControlName="category">
        <mat-option *ngFor="let option of categoryOptions" [value]="option">{{ option }}</mat-option>
      </mat-select>
      <mat-error *ngIf="showError('category')">Required</mat-error>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Payment Method</mat-label>
      <mat-select formControlName="payment">
        <mat-option *ngFor="let method of paymentOptions" [value]="method">{{ method }}</mat-option>
      </mat-select>
      <mat-error *ngIf="showError('payment')">Required</mat-error>
    </mat-form-field>
  </ng-container>

  <ng-container *ngIf="currentStep === 1">
    <mat-form-field class="full-width">
      <mat-label>Date</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="date" />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-error *ngIf="showError('date')">Required</mat-error>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Status</mat-label>
      <mat-select formControlName="status">
        <mat-option value="Paid">Paid</mat-option>
        <mat-option value="Unpaid">Unpaid</mat-option>
      </mat-select>
      <mat-error *ngIf="showError('status')">Required</mat-error>
    </mat-form-field>
  </ng-container>

  <ng-container *ngIf="currentStep === 2">
      <mat-form-field class="full-width">
        <mat-label>Notes</mat-label>
        <textarea matInput formControlName="notes"></textarea>
        <mat-error *ngIf="showError('notes')">
        {{ controls['notes'].hasError('required') ? 'Required' : 'Max 20 Char' }}
        </mat-error>
      </mat-form-field>
      
      <mat-form-field class="full-width">
        <mat-label>Receipt URL</mat-label>
        <input matInput formControlName="receipt" />
        <mat-error *ngIf="showError('receipt')">
        {{ controls['receipt'].hasError('required') ? 'Required' : 'Max 30 Char & Example :- https://avinashverma.com ' }}
        </mat-error>
      </mat-form-field>
  </ng-container>

  <ng-container *ngIf="currentStep === 3">
    <div class="summary">
      <p><strong>Title:</strong> {{ form.value.title }}</p>
      <p><strong>Amount:</strong> ₹{{ form.value.amount }}</p>
      <p><strong>Category:</strong> {{ form.value.category }}</p>
      <p><strong>Payment:</strong> {{ form.value.payment }}</p>
      <p><strong>Date:</strong> {{ form.value.date | date }}</p>
      <p><strong>Status:</strong> {{ form.value.status }}</p>
      <p><strong>Notes:</strong> {{ form.value.notes }}</p>
      <p><strong>Receipt:</strong> {{ form.value.receipt }}</p>
    </div>
  </ng-container>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">Cancel</button>
  <button mat-button *ngIf="currentStep > 0" (click)="prevStep()">Back</button>
  <button class="cont-save" mat-button *ngIf="currentStep < steps.length - 1" (click)="nextStep()">Continue</button>
  <button class="cont-save" mat-button color="primary" *ngIf="currentStep === steps.length - 1" (click)="save()">Save</button>
</mat-dialog-actions>
